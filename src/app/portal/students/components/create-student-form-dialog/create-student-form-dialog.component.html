<p-dialog
  [modal]="true"
  [visible]="showDialog()"
  [draggable]="false"
  [resizable]="false"
  [closable]="false"
  [formGroup]="createStudentForm"
  (ngSubmit)="onCreateStudent()"
  [style]="{ 'max-width': '600px', width: '100%' }"
>
  <ng-template #header>
    <div class="flex justify-between items-center w-full">
      <span class="font-bold text-xl">Crear cuenta de estudiante</span>

      <button
        class="size-[40px] flex items-center justify-center rounded-full bg-transparent hover:bg-gray-50 cursor-pointer"
        type="button"
        (click)="onCloseDialog()"
      >
        <i-lucide [img]="closeIcon" class="size-[20px] text-gray-700" />
      </button>
    </div>
  </ng-template>

  <div class="flex flex-col gap-4">
    <div class="flex flex-col gap-3">
      <div class="flex flex-col gap-1">
        <gow-text-field
          label="Nombre"
          placeholder="Ingrese el nombre del estudiante"
          formControlName="firstName"
        />

        @if (firstNameControl.invalid && firstNameControl.touched) {
          @if (hasErrorValidation(firstNameControl, "required")) {
            <p class="text-sm text-danger-500">Es requerido</p>
          } @else if (hasErrorValidation(firstNameControl, "minlength")) {
            <p class="text-sm text-danger-500">Mínimo 2 caracteres</p>
          } @else if (hasErrorValidation(firstNameControl, "maxlength")) {
            <p class="text-sm text-danger-500">Máximo 100 icaracteres</p>
          }
        }
      </div>

      <div class="flex flex-col gap-1">
        <gow-text-field
          label="Apellido"
          placeholder="Ingrese el apellido del estudiante"
          formControlName="lastName"
        />

        @if (lastNameControl.invalid && lastNameControl.touched) {
          @if (hasErrorValidation(lastNameControl, "required")) {
            <p class="text-sm text-danger-500">Es requerido</p>
          } @else if (hasErrorValidation(lastNameControl, "minlength")) {
            <p class="text-sm text-danger-500">Mínimo 2 caracteres</p>
          } @else if (hasErrorValidation(lastNameControl, "maxlength")) {
            <p class="text-sm text-danger-500">Máximo 100 icaracteres</p>
          }
        }
      </div>

      <div class="flex flex-col gap-1">
        <gow-text-field
          label="Número telefónico"
          placeholder="Ingrese el número telef́ónico del estudiante"
          formControlName="phoneNumber"
          [maxLength]="9"
        />

        @if (phoneNumberControl.invalid && phoneNumberControl.touched) {
          @if (hasErrorValidation(phoneNumberControl, "required")) {
            <p class="text-sm text-danger-500">Es requerido</p>
          } @else if (hasErrorValidation(phoneNumberControl, "phoneNumber")) {
            <p class="text-sm text-danger-500">El número telefónico es invalido</p>
          }
        }
      </div>

      @if (isAcademicPeriodActive()) {
        <div class="flex flex-col gap-1">
          <gow-select-field
            label="Personaje"
            placeholder="Selecciona su personaje"
            formControlName="character"
            [options]="characterOptions()"
            [enableClear]="false"
          />
        </div>
      }

      <div class="flex flex-col gap-1">
        <gow-text-field
          label="Correo electrónico"
          placeholder="Ingrese el correo electrónico para la cuenta del estudiante"
          formControlName="email"
        />

        @if (emailControl.invalid && emailControl.touched) {
          @if (hasErrorValidation(emailControl, "required")) {
            <p class="text-sm text-danger-500">Es requerido</p>
          } @else if (hasErrorValidation(emailControl, "email")) {
            <p class="text-sm text-danger-500">Es invalido</p>
          }
        }
      </div>

      <div class="flex flex-col gap-2">
        <gow-text-field
          label="Contraseña"
          type="password"
          placeholder="Ingrese la contraseña para la cuenta del estudiante"
          formControlName="password"
        />

        <ul class="text-gray-500 flex flex-col gap-1.5 text-base">
          <li
            class="flex gap-x-1 items-center"
            [class.text-success-600]="!invalidPasswordValidation('minlength')"
          >
            <i-lucide
              [img]="invalidPasswordValidation('minlength') ? isNoValidIcon : isValidIcon"
              class="size-5.5"
            />
            <span>Mínimo 12 caracteres</span>
          </li>
          <li
            class="flex gap-x-1 items-center"
            [class.text-success-600]="!invalidPasswordValidation('hasNumber')"
          >
            <i-lucide
              [img]="invalidPasswordValidation('hasNumber') ? isNoValidIcon : isValidIcon"
              class="size-5.5"
            />
            <span>Mínimo un número</span>
          </li>
          <li
            class="flex gap-x-1 items-center"
            [class.text-success-600]="
              !invalidPasswordValidation('hasCapitalLetter')
            "
          >
            <i-lucide
              [img]="invalidPasswordValidation('hasCapitalLetter') ? isNoValidIcon : isValidIcon"
              class="size-5.5"
            />
            <span>Mínimo una mayuscula</span>
          </li>
          <li
            class="flex gap-x-1 items-center"
            [class.text-success-600]="!invalidPasswordValidation('hasLowercase')"
          >
            <i-lucide
              [img]="invalidPasswordValidation('hasLowercase') ? isNoValidIcon : isValidIcon"
              class="size-5.5"
            />
            <span>Mínimo una minuscula</span>
          </li>
          <li
            class="flex gap-x-1 items-center"
            [class.text-success-600]="
              !invalidPasswordValidation('hasSpecialSymbols')
            "
          >
            <i-lucide
              [img]="invalidPasswordValidation('hasSpecialSymbols') ? isNoValidIcon : isValidIcon"
              class="size-5.5"
            />
            <span>Mínimo un caracter especial (/, #, %, !, etc.)</span>
          </li>
        </ul>
      </div>
    </div>

    <p-button
      type="submit"
      severity="primary"
      size="large"
      styleClass="w-full rounded-xl py-2.5"
      label="Guardar"
      (loading)="isCreatingStudentLoading()"
      (click)="onCreateStudent()"
      [disabled]="createStudentForm.invalid"
    />
  </div>
</p-dialog>
