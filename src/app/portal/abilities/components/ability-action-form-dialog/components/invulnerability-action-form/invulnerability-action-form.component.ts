import { Component, Input, input } from '@angular/core'
import { AbstractControl, FormGroup, ReactiveFormsModule } from '@angular/forms'
import { AddInvulnerabilityActionForm } from '~/abilities/models/AbilityForm.model'
import { NumberFieldComponent } from '~/shared/components/ui/number-field/number-field.component'
import { SelectFieldComponent } from '~/shared/components/ui/select-field/select-field.component'
import { AbilityActionColorSchema } from '../../ability-action-form-dialog.component'
import { AbilityInvulnerabilityTarget } from '~/abilities/models/AbilityInvulnerabilityTarget.model'
import { abilityInvulnerabilityTargetOptions } from '~/abilities/data/options/abilityInvulnerabilityTargetOptions'

@Component({
  selector: 'gow-invulnerability-action-form',
  templateUrl: './invulnerability-action-form.component.html',
  imports: [SelectFieldComponent, ReactiveFormsModule, NumberFieldComponent]
})
export class InvulnerabilityActionFormComponent {
  public readonly abilityInvulnerabilityTargetOptions =
    abilityInvulnerabilityTargetOptions
  public readonly abilityInvulnerabilityTarget = AbilityInvulnerabilityTarget

  @Input() actionForm!: FormGroup<AddInvulnerabilityActionForm>

  public colorScheme = input<AbilityActionColorSchema>('primary', {
    alias: 'colorScheme'
  })

  public hasErrorValidation(
    control: AbstractControl | null,
    validationKey: string
  ) {
    if (control === null) return false
    return control?.pristine || control?.hasError(validationKey)
  }

  get targetControl(): AbstractControl<AbilityInvulnerabilityTarget> | null {
    return this.actionForm.get('target')
  }

  get maxTargetsControl(): AbstractControl<number> | null {
    return this.actionForm.get('maxTargets')
  }
}
